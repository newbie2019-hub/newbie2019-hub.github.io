{"_path":"/basic-laravel-multi-tenancy","_dir":"","_draft":false,"_partial":false,"_locale":"","title":"Basic Laravel Multi-Tenancy","description":"Let's learn the basic or simpliest form of multi-tenancy and third party packages","date":"December 01, 2024","preview":"/img/laravel-cover.png","draft":false,"tags":["multi-tenant","laravel","php"],"categories":["php","multi-tenant","laravel"],"slug":"basic-laravel-multi-tenancy","body":{"type":"root","children":[{"type":"element","tag":"h4","props":{"id":"basic-laravel-multi-tenancy"},"children":[{"type":"text","value":"Basic Laravel Multi-tenancy"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Tenancy often concerned as team, domain or something more complex but the most basic definition of multi-tenancy is that it divides your data based on the user, account, etc.,"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"From "},{"type":"element","tag":"a","props":{"href":"https://tenancyforlaravel.com/docs/v3/introduction/","rel":["nofollow"]},"children":[{"type":"text","value":"tenancy for laravel website"}]}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"What is multi-tenancy?"}]}]},{"type":"element","tag":"blockquote","props":{},"children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Multi-tenancy is the ability to provide your service to multiple users (tenants) from a single hosted instance of the application. This is contrasted with deploying the application separately for each user."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You may find this talk insightful: "},{"type":"element","tag":"a","props":{"href":"https://multitenantlaravel.com/","rel":["nofollow"]},"children":[{"type":"text","value":"https://multitenantlaravel.com/"}]},{"type":"text","value":". Simply going through the slides will give you 80% of the value of the talk in under five minutes."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note that if you just want to, say, scope todo tasks to the current user, there's no need to use a multi-tenancy package. Just use calls like "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"auth()->user()->tasks()"}]},{"type":"text","value":". This is the simplest form of multi-tenancy."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Repeating condition of filtering by user id"}]},{"type":"element","tag":"pre","props":{"className":"language-php shiki shiki-themes github-dark","code":"public function index()\n{\n    $books = Book::where('user_id', auth()->id())->get();\n    return response()->json($books);\n}\n\npublic function store(BookRequest $request)\n{\n    $book = Book::create($request->validated() + ['user_id' => auth()->id()]);\n    return response()->json($book);\n}\n","language":"php","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"public function index()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"{\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    $books = Book::where('user_id', auth()->id())->get();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    return response()->json($books);\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"public function store(BookRequest $request)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"{\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    $book = Book::create($request->validated() + ['user_id' => auth()->id()]);\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    return response()->json($book);\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Bind user ID for every query automatically and when creating the model also. This may be repeated for other model and to prevent repetition we can extract this to a trait and apply it to the model."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note: There are also other ways that this can be achieved."}]},{"type":"element","tag":"pre","props":{"className":"language-php shiki shiki-themes github-dark","code":"class Book extends Model {\n\n    protected static function boot()\n    {\n        parent::boot();\n\n        self::creating(function($model) {\n            $model->user_id = auth()->id()\n        });\n\n        self::addGlobalScope(function(Builder $builder) {\n            $builder->where('user_id', auth()->id());\n        })\n    }\n\n}\n","language":"php","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"class Book extends Model {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    protected static function boot()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"        parent::boot();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"        self::creating(function($model) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"            $model->user_id = auth()->id()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"        });\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"        self::addGlobalScope(function(Builder $builder) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"            $builder->where('user_id', auth()->id());\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"        })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Move the boot method to a trait so that it can be applied directly to the models that will need it."}]},{"type":"element","tag":"pre","props":{"className":"language-php shiki shiki-themes github-dark","code":"use Illuminate\\Database\\Eloquent\\Builder;\n\ntrait FilterByUser {\n\n    protected static function boot()\n    {\n        parent::boot();\n\n        self::creating(function($model) {\n            $model->user_id = auth()->id()\n        });\n\n        self::addGlobalScope(function(Builder $builder) {\n            $builder->where('user_id', auth()->id());\n        })\n    }\n\n}\n","language":"php","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"use Illuminate\\Database\\Eloquent\\Builder;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"trait FilterByUser {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    protected static function boot()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"        parent::boot();\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"        self::creating(function($model) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"            $model->user_id = auth()->id()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"        });\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"        self::addGlobalScope(function(Builder $builder) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"            $builder->where('user_id', auth()->id());\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"        })\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Book Model will now look like this."}]},{"type":"element","tag":"pre","props":{"className":"language-php shiki shiki-themes github-dark","code":"use App\\Traits\\FilterByUser;\n\nclass Book extends Model {\n    use FilterByUser;\n\n    protected $fillable = ['book', 'author', 'published_at'];\n}\n","language":"php","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"use App\\Traits\\FilterByUser;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"class Book extends Model {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    use FilterByUser;\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"emptyLinePlaceholder":true},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    protected $fillable = ['book', 'author', 'published_at'];\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The concept of multi-tenancy enables a single application instance to serve multiple users (tenants) while isolating their data securely. However, for simple scenarios like scoping resources to individual users, implementing a full multi-tenancy package is unnecessary. Instead, you can manage resource filtering by leveraging traits to minimize code repetition."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For developers requiring robust multi-tenancy solutions in Laravel, Here are "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"some recommended packages:"}]}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://tenancyforlaravel.com/docs/v3/quickstart","rel":["nofollow"]},"children":[{"type":"text","value":"Tenancy For Laravel"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://spatie.be/docs/laravel-multitenancy/v4/introduction","rel":["nofollow"]},"children":[{"type":"text","value":"Laravel Multi-tenancy"}]}]}]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[]}},"_type":"markdown","_id":"content:05.basic-laravel-multi-tenancy.md","_source":"content","_file":"05.basic-laravel-multi-tenancy.md","_stem":"05.basic-laravel-multi-tenancy","_extension":"md"}